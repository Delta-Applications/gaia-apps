'use strict';(function(exports){const EntelChile='{ "data" : ['+'{ "name":"Asistencia Total" , "tel":"*727" },'+'{ "name":"Servicio al Cliente" , "tel":"103" },'+'{ "name":"Recarga" , "tel":"301" },'+'{ "name":"Zona EPCS" , "tel":"*110#" } ]}';function PreloadContactManager(){this._started=false;this.isDMValid=false;this._blobURL=null;}
PreloadContactManager.prototype={start:function(){if(this._started){throw'Instance should not be start()\'ed twice.';}
this._started=true;var lock=navigator.mozSettings.createLock();var querychecked=lock.get('Contacts.preload.checked');querychecked.onsuccess=function(){var resultchecked=querychecked.result['Contacts.preload.checked'];dump('PreloadContactManager >>> preloadchecked == '+resultchecked);if(resultchecked==undefined){var preload=false;for(let index=0;index<window.navigator.mozMobileConnections.length;index++){dump('PreloadContactManager >>> index >>>'+index);var iccid=navigator.mozMobileConnections[index].iccId;dump('PreloadContactManager >>> getIccById >>>'+iccid);if(iccid&&!preload){const icc=navigator.mozIccManager.getIccById(iccid);let simmcc=icc.iccInfo.mcc;let simmnc=icc.iccInfo.mnc;dump('PreloadContactManager simcard_info >>>get mcc = '+simmcc+', mnc = '+simmnc);if(simmcc=='730'&&(simmnc=='01'||simmnc=='10')){var preloaddata=JSON.parse(EntelChile);for(var i=0;i<preloaddata.data.length;i++){var contact=new mozContact();contact.givenName=[preloaddata.data[i].name];contact.name=[contact.givenName[0]];contact.tel=[{type:['home'],value:preloaddata.data[i].tel}];this._preloaddata(contact);}
preload=true;navigator.mozSettings.createLock().set({'Contacts.preload.checked':true});}}}}}.bind(this);},_preloaddata:function(data){var dataReq=navigator.mozContacts.save(data);dataReq.onsuccess=function(){dump('PreloadContactManager>>>a contact saved/updated');}.bind(this);dataReq.onerror=function(e){dump('PreloadContactManager>>>Error when saving a contact'+e.target.error.name);}.bind(this);},stop:function(){if(!this._started){return;}
dump('PreloadContactManager >>> stoped');this._started=false;}};exports.PreloadContactManager=PreloadContactManager;}(window));