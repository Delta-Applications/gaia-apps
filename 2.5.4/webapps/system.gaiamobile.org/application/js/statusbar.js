'use strict';var StatusBar={ELEMENTS:['emergency-cb-notification','time','connections','battery','wifi','data','flight-mode','network-activity','tethering','alarm','debugging','bluetooth','mute','headphones','bluetooth-headphones','bluetooth-transferring','recording','geolocation','usb','label','system-downloads','call-forwardings','playing','nfc','notification','tty-mode','hac-mode','ime','wificall','voltecall','dongle'],PRIORITIES:[['emergency-cb-notification',16+4],['battery',16+4],['recording',16+4],['flight-mode',16+4],['wifi',16+4],['connections',null],['time',null],['wificall',26+4],['voltecall',26+4],['debugging',16+4],['system-downloads',16+4],['geolocation',16+4],['network-activity',16+4],['tethering',16+4],['bluetooth-transferring',16+4],['bluetooth',16+4],['nfc',16+4],['usb',16+4],['alarm',16+4],['bluetooth-headphones',16+4],['mute',16+4],['call-forwardings',null],['playing',16+4],['headphones',16+4],['tty-mode',16+4],['hac-mode',16+4],['ime',16+4],['notification',null],['label',null],['dongle',16+4]],kActiveIndicatorTimeout:5*1000,active:true,_inLockScreenMode:false,settingValues:{},icons:{},wifiCallCapability:false,mobileDataIconTypes:{'lte':'4g','ehrpd':'4g','hspa+':'hspa-plus','hsdpa':'hspa','hsupa':'hspa','hspa':'hspa','evdo0':'ev','evdoa':'ev','evdob':'ev','umts':'3g','tdscdma':'3g','edge':'edge','gprs':'2g','1xrtt':'1x','is95a':'1x','is95b':'1x'},customizedTechnologyIndicators:{},customizedTechnologyIndicators_0:{'gprs':'gsm','is95a':'gsm','is95b':'gsm','1xrtt':'gsm','edge':'edge','umts':'3g','evdo0':'3g','evdoa':'3g','evdob':'3g','hsdpa':'hspa','hspa':'hspa','hspa+':'hspa-plus','ehrpd':'jio-LTE','lte':'jio-LTE'},customizedTechnologyIndicators_1:{'gprs':'2g','is95a':'2g','is95b':'2g','1xrtt':'2g','edge':'edge','umts':'3g','evdo0':'3g','evdoa':'3g','evdob':'3g','hsdpa':'hspa','hspa':'hspa','hspa+':'hspa-plus','ehrpd':'4g','lte':'4g'},customizedTechnologyIndicators_2:{'gprs':'gsm','is95a':'gsm','is95b':'gsm','1xrtt':'gsm','edge':'edge','umts':'3g','evdo0':'3g','evdoa':'3g','evdob':'3g','hsdpa':'hspa','hspa':'hspa','hspa+':'hspa-plus','ehrpd':'4g','lte':'4g'},dataExclusiveCDMATypes:{'evdo0':true,'evdoa':true,'evdob':true,'1xrtt':true,'is95a':true,'is95b':true},settings:{'ril.radio.disabled':[false,'signal','data'],'airplaneMode.status':[false,'flightMode'],'ril.data.defaultServiceId':[0,'data','voltecall','wificall','imscall'],'ril.data.enabled':[false,'data'],'wifi.enabled':[false,'wifi'],'bluetooth.enabled':[false,'bluetooth'],'tethering.usb.enabled':[false,'tethering'],'tethering.wifi.enabled':[false,'tethering'],'audio.volume.notification':[8,'mute'],'alarm.enabled':[false,'alarm'],'vibration.enabled':[false,'vibration'],'ril.cf.enabled':[false,'callForwarding'],'operatorResources.data.icon':['','iconData'],'statusbar.network-activity.disabled':[false,'networkActivity'],'debugger.remote-mode':['disabled','debugging'],'indicator.network_technology.enable':[0,'data'],'tty.mode.enabled':['off','ttyMode']},observedSettings:{},networkActivityTimer:{},geolocationActive:false,geolocationTimer:null,recordingActive:false,recordingTimer:null,nfcActive:false,umsActive:false,headphonesActive:false,listeningCallschanged:false,playingActive:false,systemDownloadsCount:0,systemDownloads:{},batteryFullNotification:null,isRegularMode:false,supportDualLte:false,customizedVoLTEIndicatorShown:false,skuid:'',clock:new Clock(),get height(){var current=Service.currentApp&&Service.currentApp.getTopMostWindow();if(document.mozFullScreen||(current&&current.isFullScreen())){return 0;}else{return this._cacheHeight||(this._cacheHeight=this.element.getBoundingClientRect().height);}},updateWifiCallState:function sb_updateWifiCallState(value){if(value){if(!this.supportDualLte){if(value.state!==undefined){this.icons.wificall.dataset.state=value.state;}
if(value.state==='error'){this.icons.wificall.hidden=false;}else{this.update.wificall.call(this);}
if(value.onCall==='onCall'){let conn=navigator.mozMobileConnections[value.index];if(conn&&conn.imsHandler){let shown=conn.imsHandler.capability==='voice-over-wifi'||conn.imsHandler.capability==='video-over-wifi';if(shown){this.icons.wificall.dataset.oncall=true;return;}}
this.icons.wificall.dataset.oncall=false;}else if(value.onCall!==undefined){this.icons.wificall.dataset.oncall=false;}}else{let defaultServiceId=this.settingValues['ril.data.defaultServiceId'];let wificallIndex=value.index?value.index:defaultServiceId;let icon=this.icons.imscall[wificallIndex];if(value.state!==undefined){icon.dataset.state=value.state;}
if(value.state==='error'){icon.hidden=false;}else{Service.request('clearWifiCallNotification');}
if(value.onCall==='onCall'){let conn=navigator.mozMobileConnections[value.index];if(conn&&conn.imsHandler){let shown=conn.imsHandler.capability==='voice-over-wifi'||conn.imsHandler.capability==='video-over-wifi';if(shown){icon.dataset.oncall=true;return;}}
icon.dataset.oncall=false;}else if(value.onCall!==undefined){icon.dataset.oncall=false;}}}},init:function sb_init(){this.supportDualLte=Service.query('supportDualLte');this.getAllElements();this._cacheHeight=this.element.getBoundingClientRect().height;this.listeningCallschanged=false;this.skuid=navigator.engmodeExtension.getPropertyValue('ro.boot.skuid');dump(`statusbar:init skuid: `+this.skuid);window.addEventListener('ftudone',this);window.addEventListener('ftuskip',this);window.addEventListener('ftuopen',this);window.addEventListener('apptitlestatechanged',this);window.addEventListener('activitytitlestatechanged',this);window.addEventListener('appchromecollapsed',this);window.addEventListener('appchromeexpanded',this);window.addEventListener('emergencycallbackstatechanged',this);window.addEventListener('keyboard-activated',this);window.addEventListener('keyboard-deactivated',this);window.addEventListener('keyboard-mode-changed',this);Service.register('updateWifiCallState',this);Service.register('addSystemDownloadListeners',this);var wifiManager=window.navigator.mozWifiManager;if(wifiManager){wifiManager.addEventListener('wifihasinternet',()=>{this.update.wifi.call(this);});}
dump('sb_sms, auto_send_sms init');AutoSendSms.init();this.readVoLTEIndicatorCustomizationValue();this.readTechnologyIndicatorCustomizationValue();if('dongleManager'in navigator){window.addEventListener('dongle-status-change',()=>{this.icons.dongle.hidden=!navigator.dongleManager.dongleStatus;this._updateIconVisibility();});}
const lock=navigator.mozSettings.createLock();const key='ftu.statusbar.icons.disabled';lock.get(key).then((value)=>{this.ftuStatusbarIconsDisabled=!!value[key];});if(lock.forceClose){lock.forceClose();}},onCustomizationApplied:function sb_onCustomizationApplied(){this.log('[onCustomizationApplied] update customization values');this.updateCustomizationValues();this.updateTechnologyIndicatorCustomizationValue();},updateCustomizationValues:function sb_updateCustomizationValues(){this.updateVoLTEIndicatorCustomizationValue();},updateTechnologyIndicatorCustomizationValue:function sb_updateTechnologyIndicatorCustomizationValue(){var self=this;self.log('[updateTechnologyIndicatorCustomizationValue]');navigator.customization.getValue('stz.indicator.network_technology.enable').then((result)=>{result=(result===undefined)?0:result;self.log('[updateTechnologyIndicatorCustomizationValue] read value: '+result);switch(result){case'0':case 0:self.customizedTechnologyIndicators=self.customizedTechnologyIndicators_0;break;case'1':case 1:self.customizedTechnologyIndicators=self.customizedTechnologyIndicators_1;break;case'2':case 2:self.customizedTechnologyIndicators=self.customizedTechnologyIndicators_2;break;default:self.customizedTechnologyIndicators=self.customizedTechnologyIndicators_0;break;}
navigator.mozSettings.createLock().set({'indicator.network_technology.enable':result});},(reason)=>{self.log('[updateTechnologyIndicatorCustomizationValue] read value failed, reset to default');self.customizedTechnologyIndicators=self.mobileDataIconTypes;navigator.mozSettings.createLock().set({'indicator.network_technology.enable':0});});},readTechnologyIndicatorCustomizationValue:function sb_readTechnologyIndicatorCustomizationValue(){var self=this;self.log('[readTechnologyIndicatorCustomizationValue]');var request=navigator.mozSettings.createLock().get('stz.indicator.network_technology.enable');request.onsuccess=function(){var result=request.result['stz.indicator.network_technology.enable'];result=(result===undefined)?0:result;self.log('[readTechnologyIndicatorCustomizationValue] read value: '+result);self.customizedTechnologyIndicators=result?self.customizedTechnologyIndicators_1:self.customizedTechnologyIndicators_0;};request.onerror=function(){self.log('[readTechnologyIndicatorCustomizationValue] read value failed, reset to default');self.customizedTechnologyIndicators=self.mobileDataIconTypes;};},addSettingsListener:function sb_addSettingsListener(settingKey){if(this.observedSettings[settingKey]){return;}
this.observedSettings[settingKey]=true;SettingsListener.observe(settingKey,false,(value)=>{this.settingValues[settingKey]=value;this.settings[settingKey].forEach((name,index)=>{index&&this.update[name].call(this);});},{forceClose:settingKey.startsWith('tethering.')?false:true});this.settingValues[settingKey]=this.settings[settingKey][0];},addConnectionsListeners:function(){var conns=window.navigator.mozMobileConnections;if(conns){Array.from(conns).forEach((conn)=>{conn.addEventListener('voicechange',this);conn.addEventListener('datachange',this);conn.addEventListener('signalstrengthchange',this);var ims=conn.imsHandler;if(ims){ims.addEventListener('capabilitychange',this);if(this.supportDualLte){this.update.imscall.call(this);}else{this.update.wificall.call(this);this.update.voltecall.call(this);}}
this.update.signal.call(this);this.update.data.call(this);});}},removeConnectionsListeners:function(){var conns=window.navigator.mozMobileConnections;if(conns){Array.from(conns).forEach((conn)=>{conn.removeEventListener('voicechange',this);conn.removeEventListener('datachange',this);conn.removeEventListener('signalstrengthchange',this);});}},finishInit:function(){this.createConnectionsElements();this.createCallForwardingsElements();this.toggleTimeLabel(true);for(var key in this.settings){this.addSettingsListener(key);}
window.addEventListener('attentionopened',this);window.addEventListener('attentionclosed',this);window.addEventListener('rocketbar-deactivated',this);window.addEventListener('screenchange',this);var acm=navigator.mozAudioChannelManager;if(acm){this.headphonesActive=acm.headphones;this.update.headphones.call(this);}
window.addEventListener('mozChromeEvent',this);window.addEventListener('audiochannelchanged',this);window.addEventListener('nfc-state-changed',this);window.addEventListener('wifi-stationchange',this);window.addEventListener('bluetoothconnectionchange',this);window.addEventListener('bluetoothprofileconnectionchange',this);if(navigator.mozBluetooth){this.update.bluetoothProfiles.call(this);}
window.addEventListener('moztimechange',this);window.addEventListener('timeformatchange',this);window.addEventListener('languagechange',this);window.addEventListener('lockscreen-appopened',this);window.addEventListener('lockscreen-appclosing',this);window.addEventListener('attentionopened',this);window.addEventListener('appopened',this);window.addEventListener('appopening',this);window.addEventListener('hierarchytopmostwindowchanged',this);window.addEventListener('activityopened',this);window.addEventListener('activityclosed',this);window.addEventListener('homescreenopened',this);window.addEventListener('hacchange',this);window.addEventListener('update-notification-count',this);this.updateNotification(Service.query('NotificationStore.unreadCount')||0,true);var mozDownloadManager=navigator.mozDownloadManager;if(mozDownloadManager){mozDownloadManager.addEventListener('downloadstart',this);}
this.systemDownloadsCount=0;this.setActive(true);this.handleHacMode();},handleEvent:function sb_handleEvent(evt){switch(evt.type){case'audiochannelchanged':var active=evt.detail.channel==='content'&&!this.recordingActive;var activeMediaApp=Service.query('activeMediaApp');if(active&&activeMediaApp&&activeMediaApp.endsWith('/OSlAbgrhLArfT7grf4_N')){active=false;}
if(this.playingActive===active){break;}
this.playingActive=active;this.update.playing.call(this);window.ExternalScreenManager.send(new CustomEvent('audiochange',{detail:{active:this.playingActive}}));break;case'capabilitychange':if(this.supportDualLte){this.update.imscall.call(this);}else{this.update.wificall.call(this);this.update.voltecall.call(this);}
break;case'emergencycallbackstatechanged':this.updateEmergencyCbNotification(evt.detail);break;case'screenchange':this.setActive(evt.detail.screenEnabled);this._updateIconVisibility();break;case'lockscreen-appopened':this._updateIconVisibility();this._inLockScreenMode=true;this.setAppearance(evt);break;case'lockscreen-appclosing':this._inLockScreenMode=false;this.setAppearance(evt);break;case'appopening':this.setAppearance(evt);break;case'attentionopened':this.toggleTimeLabel(true);this.element.classList.add('maximized');this.element.classList.remove('light');break;case'attentionclosed':this.toggleTimeLabel(true);break;case'chargingchange':case'levelchange':case'statuschange':case'powersupplystatuschanged':this.update.battery.call(this);break;case'voicechange':this.update.signal.call(this);this.update.label.call(this);break;case'cardstatechange':this.update.signal.call(this);this.update.label.call(this);this.update.data.call(this);break;case'callschanged':this.update.signal.call(this);this.update.data.call(this);break;case'simslot-iccinfochange':this.update.label.call(this);break;case'wifi-statuschange':this.update.wifi.call(this);break;case'datachange':this.update.signal.call(this);this.update.data.call(this);break;case'signalstrengthchange':this.update.signal.call(this);break;case'bluetoothprofileconnectionchange':this.update.bluetoothProfiles.call(this);break;case'languagechange':case'timeformatchange':case'moztimechange':navigator.mozL10n.ready((function _updateTime(){this.toggleTimeLabel(false);this.toggleTimeLabel(true);}).bind(this));break;case'nfc-state-changed':this.setActiveNfc(evt.detail.active);break;case'wifi-stationchange':this.update.tethering.call(this);break;case'mozChromeEvent':switch(evt.detail.type){case'geolocation-status':this.geolocationActive=evt.detail.active;this.update.geolocation.call(this);break;case'mtp-state-changed':case'volume-state-changed':this.umsActive=evt.detail.active;this.update.usb.call(this);break;case'headphones-status-changed':this.headphonesActive=(evt.detail.state!='off');this.update.headphones.call(this);break;}
break;case'moznetworkupload':case'moznetworkdownload':this.update.networkActivity.call(this);break;case'ftuopen':if(!FtuLauncher.isFtuUpgrading()&&this.ftuStatusbarIconsDisabled){this.setActiveBattery(true);this._updateIconVisibility();}else{this.finishInit();}
break;case'ftudone':this.finishInit();break;case'ftuskip':this.finishInit();break;case'rocketbar-deactivated':case'appchromecollapsed':this.setAppearance(evt);break;case'hierarchytopmostwindowchanged':case'appchromeexpanded':this.setAppearance(evt);this.element.classList.remove('hidden');break;case'activityopened':case'activityclosed':case'apptitlestatechanged':case'activitytitlestatechanged':this.setAppearance(evt);if(!this.isPaused()){this.element.classList.remove('hidden');}
break;case'homescreenopened':this.setAppearance(evt);this.resumeUpdate(evt.type);this.element.classList.remove('hidden');this.element.classList.remove('fullscreen');this.element.classList.remove('fullscreen-layout');break;case'downloadstart':this.addSystemDownloadListeners(evt.download);break;case'update-notification-count':this.updateNotification(evt.detail.count,evt.detail.listUnread);break;case'hacchange':this.handleHacMode();break;case'keyboard-activated':case'keyboard-deactivated':case'keyboard-mode-changed':this.handleKeyboardChanged(evt);break;}},handleHacMode:function(){var hacModeIcon=this.icons.hacMode;hacModeIcon.hidden=!Service.query('hacMode');this._updateIconVisibility();},handleKeyboardChanged:function(evt){var imeIcon=this.icons.ime;var mode=evt.detail&&evt.detail.mode;var iconText=evt.detail&&evt.detail.iconText;var activeLayout=evt.detail&&evt.detail.activeLayout;var modeMap={'abc':{text:'ab',icon:''},'ABC':{text:'AB',icon:''},'123':{text:'12',icon:''},'Abc':{text:'Ab',icon:''},'T9':{text:'',icon:'predictive-text'}};if(iconText&&mode==='abc'||activeLayout&&(activeLayout.indexOf('chinese')>-1||activeLayout==='korean')&&mode==='T9'){imeIcon.hidden=false;imeIcon.textContent=iconText;imeIcon.dataset.icon='';}else if(mode){imeIcon.hidden=false;imeIcon.textContent=modeMap[mode].text;imeIcon.dataset.icon=modeMap[mode].icon;}
if(evt.type==='keyboard-deactivated'){imeIcon.hidden=true;imeIcon.textContent='';imeIcon.dataset.icon='';}
imeIcon.hidden=(!imeIcon.textContent&&!imeIcon.dataset.icon);this._updateIconVisibility();},addSystemDownloadListeners:function(download){var handler=function handleDownloadStateChange(downloadEvent){var download=downloadEvent.download;switch(download.state){case'downloading':if(!this.systemDownloads[download.id]){this.incSystemDownloads();this.systemDownloads[download.id]=true;}
break;case'finalized':download.removeEventListener('statechange',handler);break;case'stopped':case'succeeded':if(this.systemDownloads[download.id]){this.decSystemDownloads();delete this.systemDownloads[download.id];}
break;default:console.warn('Unexpected download state = ',download.state);}}.bind(this);download.addEventListener('statechange',handler);},setAppearance:function(evt){if(this._inLockScreenMode){this.element.classList.add('maximized');return;}
var app=Service.query('getTopMostWindow');if(!app){return;}
var topWindow=app.getTopMostWindow();if(topWindow){if(topWindow.appChrome){this.element.classList.toggle('light',!!(topWindow.appChrome&&topWindow.appChrome.useLightTheming()));}
this.element.classList.toggle('fullscreen',topWindow.isFullScreen());this.element.classList.toggle('fullscreen-layout',topWindow.isFullScreenLayout());if(topWindow.element.classList.contains('popupWindow')){let rearWindow=topWindow.rearWindow;while(rearWindow&&rearWindow.element.classList.contains('popupWindow')){rearWindow=rearWindow.rearWindow;}
if(rearWindow&&rearWindow.element.classList.contains('fullscreen-app')){this.element.classList.add('fullscreen');}}}
this.element.classList.toggle('maximized',app.isHomescreen||app.isAttentionWindow||!!(app.appChrome&&app.appChrome.isMaximized()));if(evt.detail&&evt.detail.isBackgroundTransparent&&evt.detail.isBackgroundTransparent()){if(evt.type==='activityopened'&&app.isFullScreen()){this.element.classList.add('transparent-activity');}
if(evt.type==='activityclosed'){this.element.classList.remove('transparent-activity');}}
if(this.element.classList.contains('transparent-activity')){const rearWindow=topWindow&&topWindow.rearWindow;const enabled=!!(rearWindow&&(!rearWindow.isFullScreen()||rearWindow.isOverlappingStatusbar()));this.element.classList.toggle('overlap',enabled);}else{const enabled=app.isOverlappingStatusbar()?true:false;this.element.classList.toggle('overlap',enabled);}},_getMaximizedStatusBarWidth:function sb_getMaximizedStatusBarWidth(){return Math.round(layoutManager.width-(3*2));},_getBatteryLevelForIcon:function(percent){return Math.max(Math.floor((percent*100+5)/10),1);},_paused:0,_eventGroupStates:{sheetsgesture:false,marionette:false},pauseUpdate:function sb_pauseUpdate(evtType){var eventGroup=this._eventTypeToEventGroup(evtType);if(this._eventGroupStates[eventGroup]){return;}
this._eventGroupStates[eventGroup]=true;this._paused++;},resumeUpdate:function sb_resumeUpdate(evtType){var eventGroup=this._eventTypeToEventGroup(evtType);if(!this._eventGroupStates[eventGroup]){return;}
this._eventGroupStates[eventGroup]=false;this._paused--;if(!this.isPaused()){this._updateIconVisibility();}},_eventTypeToEventGroup:function sb_eventTypeToEventGroup(evtType){switch(evtType){case'homescreenopened':return'sheetsgesture';}
return evtType;},isPaused:function sb_isPaused(){return this._paused>0;},_updateIconVisibility:function sb_updateIconVisibility(){if(this.isPaused()){return;}
var maximizedStatusBarWidth=this._getMaximizedStatusBarWidth();this.PRIORITIES.forEach(function sb_updateIconVisibilityForEach(iconObj){var iconId=iconObj[0];var icon=this.icons[this.toCamelCase(iconId)];if(!icon||icon.hidden){return;}
var className='sb-hide-'+iconId;if(maximizedStatusBarWidth<0){this.statusbarIcons.classList.add(className);return;}
this.statusbarIcons.classList.remove(className);var iconWidth=this._getIconWidth(iconObj);maximizedStatusBarWidth-=iconWidth;if(maximizedStatusBarWidth<0){this.statusbarIcons.classList.add(className);return;}}.bind(this));},_getIconWidth:function sb_getIconWidth(iconObj){var iconWidth=iconObj[1];if(!iconWidth){var icon=this.icons[this.toCamelCase(iconObj[0])];iconWidth=this._getWidthFromDomElementWidth(icon);}
return iconWidth;},_getWidthFromDomElementWidth:function sb_getWidthFromDomElementWidth(icon){var style=window.getComputedStyle(icon);var iconWidth=icon.clientWidth+
parseInt(style.marginLeft,10)+
parseInt(style.marginRight,10);return iconWidth;},handleFtuStep:function sb_handleFtuStep(stepHash){switch(stepHash){case'#languages':this.createConnectionsElements();this._updateIconVisibility();this.addConnectionsListeners();this.addSettingsListener('ril.data.enabled');break;case'#wifi':this.setActiveWifi(true);this.addSettingsListener('wifi.enabled');this._updateIconVisibility();break;case'#date_and_time':this.toggleTimeLabel(true);this._updateIconVisibility();break;}},setActive:function sb_setActive(active){this.active=active;this.setActiveBattery(active);if(active){this.setActiveNfc(nfcManager.isActive());this.addConnectionsListeners();window.addEventListener('simslot-iccinfochange',this);window.addEventListener('wifi-statuschange',this);this.setActiveWifi(true);window.addEventListener('moznetworkupload',this);window.addEventListener('moznetworkdownload',this);this.refreshCallListener();this.toggleTimeLabel(true);}else{this.removeConnectionsListeners();window.removeEventListener('simslot-iccinfochange',this);window.removeEventListener('wifi-statuschange',this);window.removeEventListener('moznetworkupload',this);window.removeEventListener('moznetworkdownload',this);this.removeCallListener();this.toggleTimeLabel(false);}},setActiveBattery:function sb_setActiveBattery(active){var battery=window.navigator.battery;if(!battery){return;}
var powersupply=window.navigator.powersupply;if(active){battery.addEventListener('chargingchange',this);battery.addEventListener('levelchange',this);battery.addEventListener('statuschange',this);if(powersupply){powersupply.addEventListener('powersupplystatuschanged',this);}
this.update.battery.call(this);}else{battery.removeEventListener('chargingchange',this);battery.removeEventListener('levelchange',this);battery.removeEventListener('statuschange',this);if(powersupply){powersupply.removeEventListener('powersupplystatuschanged',this);}}},setActiveWifi:function sb_setActiveWifi(active){if(active){var wifiManager=window.navigator.mozWifiManager;if(wifiManager){wifiManager.onconnectioninfoupdate=this.update.wifi.bind(this);}
this.update.wifi.call(this);}},setActiveNfc:function sb_setActiveNfc(active){this.nfcActive=active;this.update.nfc.call(this);},wifiCallMissEcc:function isWifiCallMissEcc(defaultDataId){var missEccOpt=null;var mccmnc=null;if(defaultDataId!==false&&defaultDataId>=0){var conn=navigator.mozMobileConnections[defaultDataId];if(conn&&conn.voice&&conn.voice.network&&conn.voice.network.mcc){mccmnc=conn.voice.network.mcc+conn.voice.network.mnc;}
if(!mccmnc&&conn.iccId){var icc=navigator.mozIccManager.getIccById(conn.iccId);mccmnc=icc&&icc.iccInfo?icc.iccInfo.mcc+icc.iccInfo.mnc:null;}}
if(mccmnc){if(mccmnc==='20205'||mccmnc==='20404'||mccmnc==='21401'||mccmnc==='21670'||mccmnc==='22210'||mccmnc==='23003'||mccmnc==='26202'||mccmnc==='26209'||mccmnc==='26801'||mccmnc==='22601'||mccmnc==='27602'){missEccOpt='Vodafone';}else if(mccmnc==='20601'){missEccOpt=' ';}}
return missEccOpt;},update:{iconData:function sb_updateIconData(){var dataIconValues=this.settingValues['operatorResources.data.icon'];if(!dataIconValues){return;}
for(var key in dataIconValues){if(this.customizedTechnologyIndicators[key]){this.customizedTechnologyIndicators[key]=dataIconValues[key];}}},label:function sb_updateLabel(){var conns=window.navigator.mozMobileConnections;var conn;if(conns&&conns.length===1){conn=conns[0];}
var self=this;var label=this.icons.label;var previousLabelContent=label.textContent;var newLabelContent='';var l10nArgs=JSON.parse(label.dataset.l10nArgs||'{}');var shown=false;if(conn){var imsRegHandler=conn.imsHandler;if(imsRegHandler){shown=imsRegHandler.capability==='voice-over-wifi'||imsRegHandler.capability==='video-over-wifi';}}
if((!conn||!conn.voice||!conn.voice.connected||conn.voice.emergencyCallsOnly)&&!shown){label.hidden=true;newLabelContent='';if(previousLabelContent!==newLabelContent){label.textContent=newLabelContent;updateLabelWidth();}
return;}
var operatorInfos=MobileOperator.userFacingInfo(conn);l10nArgs.operator=operatorInfos.operator;if(operatorInfos.region){l10nArgs.operator+=' '+operatorInfos.region;}
label.dataset.l10nArgs=JSON.stringify(l10nArgs);newLabelContent=l10nArgs.operator.trim();if(previousLabelContent!==newLabelContent){label.hidden=!newLabelContent;label.textContent=newLabelContent;updateLabelWidth();}
function updateLabelWidth(){self.PRIORITIES.some(function(iconObj){if(iconObj[0]==='label'){iconObj[1]=self._getWidthFromDomElementWidth(label);return true;}
return false;});}},time:function sb_updateTime(now){now=now||new Date();var _=navigator.mozL10n.get;var f=new navigator.mozL10n.DateTimeFormat();var timeFormat=window.navigator.mozHour12?_('shortTimeFormat12'):_('shortTimeFormat24');timeFormat=timeFormat.replace('%p','<span>%p</span>');var formatted=f.localeFormat(now,timeFormat);this.icons.time.innerHTML=formatted;var label=this.icons.label;var l10nArgs=JSON.parse(label.dataset.l10nArgs||'{}');l10nArgs.date=f.localeFormat(now,_('statusbarDateFormat'));label.dataset.l10nArgs=JSON.stringify(l10nArgs);this.update.label.call(this);this._updateIconVisibility();},battery:function sb_updateBattery(){var battery=window.navigator.battery;if(!battery){return;}
var icon=this.icons.battery;var previousLevel=parseInt(icon.dataset.level,10);var previousCharging=icon.dataset.charging==='true';dump("statusbar.js, battery.level:"+battery.level+", battery.charging:"+battery.charging);var previousFull=icon.dataset.full;var isDirty=false;var newCharging=battery.charging;var powersupply=window.navigator.powersupply;if(powersupply){dump("statusbar.js, battery, powersupply.powerSupplyOnline:"+powersupply.powerSupplyOnline);if(!powersupply.powerSupplyOnline){newCharging=false;}
icon.dataset.full=battery.level===1&&powersupply.powerSupplyOnline;if(previousFull!==icon.dataset.full){isDirty=true;}}
icon.dataset.charging=newCharging;var level=this._getBatteryLevelForIcon(battery.level);if(previousLevel!==level||previousCharging!==newCharging){icon.dataset.level=level;navigator.mozL10n.setAttributes(icon,newCharging?'statusbarBatteryCharging':'statusbarBattery',{level:level});isDirty=true;}
dump("statusbar.js, battery, isDirty:"+isDirty);if(isDirty){this._updateIconVisibility();}},networkActivity:function sb_updateNetworkActivity(){var defaultServiceId=this.settingValues['ril.data.defaultServiceId'];var icon=this.icons.dataConnection[defaultServiceId];if(this.icons.data[defaultServiceId].hidden){return;}
clearTimeout(this.networkActivityTimer[defaultServiceId]);this.networkActivityTimer[defaultServiceId]=setTimeout(function hideNetActivityIcon(){icon.hidden=true;this._updateIconVisibility();}.bind(this),500);if(icon.hidden){icon.hidden=false;this._updateIconVisibility();}},flightMode:function sb_flightMode(){var flightModeIcon=this.icons.flightMode;var status=this.settingValues['airplaneMode.status'];if(status==='enabled'){flightModeIcon.hidden=false;}else if(status==='disabled'){flightModeIcon.hidden=true;}
this._updateIconVisibility();},ttyMode:function sb_ttyMode(){var ttyModeIcon=this.icons.ttyMode;var status=this.settingValues['tty.mode.enabled'];ttyModeIcon.hidden=(status==='off');this._updateIconVisibility();},signal:function sb_updateSignal(){var simSlots=SIMSlotManager.getSlots();var isDirty=false;for(var index=0;index<simSlots.length;index++){var simslot=simSlots[index];var conn=simslot.conn;var voice=conn.voice;var data=conn.data;var icon=this.icons.signals[index];var subscripts=this.icons.subscripts[index];var roaming=this.icons.roaming[index];var hasActiveCall=this.hasActiveCall();var voiceConnected=voice&&voice.connected;var dataConnected=data&&data.connected;var _=navigator.mozL10n.get;if(!voice){continue;}
var previousHiddenState=icon.hidden;var previousActiveState=icon.dataset.inactive;var previousSearchingState=icon.dataset.searching;var previousRoamingHiddenState=roaming.hidden;if(this.settingValues['ril.radio.disabled']||(conn.radioState!=='enabled'&&conn.radioState!=='enabling')){icon.dataset.inactive=false;icon.hidden=true;if(previousHiddenState!==icon.hidden){isDirty=true;}
continue;}
icon.hidden=false;icon.dataset.inactive=false;subscripts.hidden=false;if(simslot.isAbsent()){delete icon.dataset.level;delete icon.dataset.searching;roaming.hidden=true;icon.hidden=true;if(!this.isRegularMode){icon.dataset.inactive=true;}
icon.setAttribute('aria-label',_('noSimCard'));}else if(dataConnected&&data.type&&data.type.startsWith('evdo')){this.updateSignalIcon(icon,data,conn.signalStrength);}else if(simslot.isLocked()){icon.hidden=true;}else if(conn.radioState&&(voiceConnected||data&&data.state==='registered'||hasActiveCall&&navigator.mozTelephony.active.serviceId===index)){this.updateSignalIcon(icon,(voiceConnected||hasActiveCall)?voice:data,conn.signalStrength);}else{icon.dataset.level=0;icon.dataset.searching=(voice.state==='searching');roaming.hidden=true;icon.setAttribute('aria-label',_(icon.dataset.searching?'statusbarSignalNoneSearching':'emergencyCallsOnly'));}
if(previousHiddenState!==icon.hidden||previousActiveState!==icon.dataset.inactive||previousSearchingState!==icon.dataset.searching||previousRoamingHiddenState!==roaming.hidden){isDirty=true;}}
this.updateConnectionsVisibility();this.refreshCallListener();if(isDirty){this._updateIconVisibility();}},data:function sb_updateSignal(){var conns=window.navigator.mozMobileConnections;if(!conns){this.updateConnectionsVisibility();return;}
var isDirty=false;for(var index=0;index<conns.length;index++){var conn=conns[index];var data=conn.data;var icon=this.icons.data[index];if(!data){continue;}
var previousHiddenState=icon.hidden;if(this.settingValues['ril.radio.disabled']||!this.settingValues['ril.data.enabled']||data.state!=='registered'||!this.icons.wifi.hidden||!data.connected){icon.hidden=true;if(previousHiddenState!==icon.hidden){isDirty=true;}
continue;}
var type=this.customizedTechnologyIndicators[data.type];icon.dataset.icon='';if(type){if(this.dataExclusiveCDMATypes[data.type]){var telephony=window.navigator.mozTelephony;if(telephony.calls&&telephony.calls.length>0){icon.hidden=true;}else{icon.dataset.icon=type;}}else{icon.dataset.icon=type;}}
icon.hidden=!icon.dataset.icon;icon.setAttribute('aria-hidden',!!icon.dataset.icon);if(previousHiddenState!==icon.hidden){isDirty=true;}}
this.updateConnectionsVisibility();this.refreshCallListener();if(isDirty){this._updateIconVisibility();}},imscall:function(){if(!this.supportDualLte||!navigator.mozMobileConnections){return;}
let conns=navigator.mozMobileConnections;for(let index=0;index<conns.length;index++){let icon=this.icons.imscall[index];let shown=false;let state='';let imsRegHandler=navigator.mozMobileConnections[index].imsHandler;if(imsRegHandler){shown=imsRegHandler.capability==='voice-over-cellular'||imsRegHandler.capability==='video-over-cellular';state=!imsRegHandler.unregisteredReason?'':'error';icon.hidden=!shown;icon.dataset.state=state;if(shown){if(this.skuid==='62HMX'||this.skuid==='62GMX'){icon.dataset.icon='amx-volte';}else{icon.dataset.icon='volte';}
continue;}
shown=imsRegHandler.capability==='voice-over-wifi'||imsRegHandler.capability==='video-over-wifi';state=!imsRegHandler.unregisteredReason?'':'error';if(state==='error'){Service.request('updateWifiCallState',{state:'error',index:index});Service.request('showWifiCallNotification',index);}else{Service.request('clearWifiCallNotification');}
icon.hidden=!shown;icon.dataset.state=state;if(shown){if(this.skuid==='62HMX'||this.skuid==='62GMX'){icon.dataset.icon='amx-vowifi';}else{icon.dataset.icon='vowifi';}}}else{icon.hidden=!shown;icon.dataset.state=state;}}},voltecall:function(){if(this.supportDualLte||!navigator.mozMobileConnections){return;}
var shown=false;var state='';var defaultServiceId=this.settingValues['ril.data.defaultServiceId'];if(defaultServiceId!==false&&defaultServiceId>=0){var imsRegHandler=navigator.mozMobileConnections[defaultServiceId].imsHandler;if(imsRegHandler){shown=imsRegHandler.capability==='voice-over-cellular'||imsRegHandler.capability==='video-over-cellular';state=!imsRegHandler.unregisteredReason?'':'error';}}
this.log(`[voltecall] shown: ${shown}, customizedVoLTEIndicatorShown: ${this.customizedVoLTEIndicatorShown}`);this.icons.voltecall.hidden=!(shown&&this.customizedVoLTEIndicatorShown);this.icons.voltecall.dataset.state=state;if(this.skuid==='62HMX'||this.skuid==='62GMX'){this.icons.voltecall.dataset.icon='amx-volte';}else{this.icons.voltecall.dataset.icon='volte';}},wificall:function(){if(this.supportDualLte||!navigator.mozMobileConnections){return;}
var shown=false;var state='';var defaultServiceId=this.settingValues['ril.data.defaultServiceId'];if(defaultServiceId!==false&&defaultServiceId>=0){var imsRegHandler=navigator.mozMobileConnections[defaultServiceId].imsHandler;if(imsRegHandler){shown=imsRegHandler.capability==='voice-over-wifi'||imsRegHandler.capability==='video-over-wifi';state=!imsRegHandler.unregisteredReason?'':'error';}}
if(this.skuid==='62HMX'||this.skuid==='62GMX'){this.icons.wificall.dataset.icon='amx-vowifi';}else{this.icons.wificall.dataset.icon='vowifi';}
if(state==='error'){Service.request('updateWifiCallState',{state:'error'});Service.request('showWifiCallNotification',defaultServiceId);}else{this.icons.wificall.dataset.state='';this.icons.wificall.hidden=!shown;Service.request('clearWifiCallNotification');}
if(this.wifiCallCapability!==shown){var missEccOpt=shown?this.wifiCallMissEcc(defaultServiceId):null;if(missEccOpt){Service.request('showWifiCallMissEccNotification',missEccOpt);}else{Service.request('clearWifiCallMissEccNotification');}
this.wifiCallCapability=shown;}},wifi:function sb_updateWifi(){var wifiManager=window.navigator.mozWifiManager;if(!wifiManager){return;}
var icon=this.icons.wifi;var wasHidden=icon.hidden;if(!this.settingValues['wifi.enabled']){icon.hidden=true;if(!wasHidden){this.update.data.call(this);}
return;}
switch(wifiManager.connection.status){case'disconnected':case'dhcpfailed':case'authenticationfailed':case'associationreject':icon.hidden=true;break;case'connecting':case'associated':icon.hidden=false;icon.dataset.connecting=true;icon.dataset.level=0;icon.setAttribute('aria-label',navigator.mozL10n.get('statusbarWiFiConnecting'));break;case'connected':icon.hidden=false;if(icon.dataset.connecting){delete icon.dataset.connecting;}
this.noInternet.hidden=wifiManager.hasInternet;var level=Math.min(Math.floor(wifiManager.connectionInformation.relSignalStrength/20),4);icon.dataset.level=level;icon.setAttribute('aria-label',navigator.mozL10n.get('statusbarWiFiConnected',{level:level}));break;}
if(icon.hidden!==wasHidden){this.update.data.call(this);}
this._updateIconVisibility();},tethering:function sb_updateTethering(){var icon=this.icons.tethering;icon.hidden=!(this.settingValues['tethering.usb.enabled']||this.settingValues['tethering.wifi.enabled']);icon.dataset.active=(Service.query('Wifi.connectedClients')>0)||this.settingValues['tethering.usb.enabled'];this.updateIconLabel(icon,'tethering',icon.dataset.active);this._updateIconVisibility();},bluetooth:function sb_updateBluetooth(){var icon=this.icons.bluetooth;icon.hidden=!this.settingValues['bluetooth.enabled'];this._updateIconVisibility();},bluetoothProfiles:function sv_updateBluetoothProfiles(){var bluetoothHeadphoneIcon=this.icons.bluetoothHeadphones;var bluetoothTransferringIcon=this.icons.bluetoothTransferring;var icon=this.icons.bluetooth;bluetoothHeadphoneIcon.hidden=!Bluetooth.isProfileConnected(Bluetooth.Profiles.A2DP);bluetoothTransferringIcon.hidden=!Bluetooth.isProfileConnected(Bluetooth.Profiles.OPP);icon.dataset.active=Bluetooth.connected;this.updateIconLabel(icon,'bluetooth',icon.dataset.active);this._updateIconVisibility();},alarm:function sb_updateAlarm(){this.icons.alarm.hidden=!this.settingValues['alarm.enabled'];this._updateIconVisibility();},mute:function sb_updateMute(){var icon=this.icons.mute;icon.hidden=(this.settingValues['audio.volume.notification']!==0);this.updateIconLabel(icon,(this.settingValues['vibration.enabled']===true)?'vibration':'mute');this._updateIconVisibility();},vibration:function sb_vibration(){var icon=this.icons.mute;var vibrate=(this.settingValues['vibration.enabled']===true);if(vibrate){icon.classList.add('vibration');this.updateIconLabel(icon,'vibration');}else{icon.classList.remove('vibration');this.updateIconLabel(icon,'mute');}},recording:function sb_updateRecording(){clearTimeout(this.recordingTimer);var icon=this.icons.recording;icon.dataset.active=this.recordingActive;if(this.recordingActive){icon.hidden=false;this._updateIconVisibility();return;}
this.recordingTimer=setTimeout(function hideRecordingIcon(){icon.hidden=true;this._updateIconVisibility();}.bind(this),this.kActiveIndicatorTimeout);},geolocation:function sb_updateGeolocation(){clearTimeout(this.geolocationTimer);var icon=this.icons.geolocation;icon.dataset.active=this.geolocationActive;if(this.geolocationActive){icon.hidden=false;this._updateIconVisibility();return;}
this.geolocationTimer=setTimeout(function hideGeolocationIcon(){icon.hidden=true;this._updateIconVisibility();}.bind(this),this.kActiveIndicatorTimeout);},usb:function sb_updateUsb(){var icon=this.icons.usb;icon.hidden=!this.umsActive;this._updateIconVisibility();},headphones:function sb_updateHeadphones(){var icon=this.icons.headphones;icon.hidden=!this.headphonesActive;this._updateIconVisibility();},systemDownloads:function sb_updatesystemDownloads(){var icon=this.icons.systemDownloads;icon.hidden=(this.systemDownloadsCount===0);this._updateIconVisibility();},callForwarding:function sb_updateCallForwarding(){var icons=this.icons.callForwardingsElements;var states=this.settingValues['ril.cf.enabled'];if(states){states.forEach(function(state,index){if(icons[index]){if(!navigator.mozMobileConnections[index].iccId){icons[index].hidden=true;}else{icons[index].hidden=!state;}}});}
this.updateCallForwardingsVisibility();this._updateIconVisibility();},playing:function sb_updatePlaying(){var icon=this.icons.playing;icon.hidden=!this.playingActive;this._updateIconVisibility();},nfc:function sb_updateNfc(){var icon=this.icons.nfc;icon.hidden=!this.nfcActive;this._updateIconVisibility();},debugging:function sb_updateDebugging(){var icon=this.icons.debugging;icon.hidden=this.settingValues['debugger.remote-mode']=='disabled';this._updateIconVisibility();}},updateConnectionsVisibility:function sb_updateConnectionsVisibility(){var conns=window.navigator.mozMobileConnections;if(!conns||!this.icons.signals){return;}
var icons=this.icons;icons.connections.hidden=false;icons.connections.dataset.multiple=SIMSlotManager.isMultiSIM()&&!this.isRegularMode;for(var index=0;index<conns.length;index++){if(icons.signals[index].dataset.inactive!=='false'){icons.signals[index].hidden=false;icons.subscripts[index].hidden=true;}}},updateCallForwardingsVisibility:function sb_updateCallFwdingsVisibility(){var conns=window.navigator.mozMobileConnections;if(!conns){return;}
var icons=this.icons;for(var index=0;index<conns.length;index++){if(!icons.callForwardingsElements[index].hidden){icons.callForwardings.hidden=false;return;}}
icons.callForwardings.hidden=true;},hasActiveCall:function sb_hasActiveCall(){var telephony=navigator.mozTelephony;return!!(telephony&&telephony.active);},updateIconLabel:function sb_updateIconLabel(icon,type,active){if(icon.hidden){return;}
icon.setAttribute('aria-label',navigator.mozL10n.get((active?'statusbarIconOnActive-':'statusbarIconOn-')+type));},updateSignalIcon:function sb_updateSignalIcon(icon,connInfo,signalStrength){if(signalStrength){icon.dataset.level=signalStrength.level+1;}else{icon.dataset.level=Math.ceil(connInfo.relSignalStrength/20);}
icon.dataset.roaming=connInfo.roaming;var slotIndex=icon.dataset.index?(icon.dataset.index-1):0;var roaming=this.icons.roaming[slotIndex];roaming.hidden=!connInfo.roaming;delete icon.dataset.searching;icon.setAttribute('aria-label',navigator.mozL10n.get(connInfo.roaming?'statusbarSignalRoaming':'statusbarSignal',{level:icon.dataset.level,operator:connInfo.network&&connInfo.network.shortName}));},refreshCallListener:function sb_refreshCallListener(){var conns=window.navigator.mozMobileConnections;if(!conns){return;}
var emergencyCallsOnly=false;var cdmaConnection=false;var self=this;Array.prototype.slice.call(conns).forEach(function(conn){emergencyCallsOnly=emergencyCallsOnly||(conn&&conn.voice&&conn.voice.emergencyCallsOnly);cdmaConnection=cdmaConnection||(conn&&conn.data&&!!self.dataExclusiveCDMATypes[conn.data.type]);});if(emergencyCallsOnly||cdmaConnection){this.addCallListener();}else{this.removeCallListener();}},addCallListener:function sb_addCallListener(){var telephony=navigator.mozTelephony;if(telephony&&!this.listeningCallschanged){this.listeningCallschanged=true;telephony.addEventListener('callschanged',this);}},removeCallListener:function sb_addCallListener(){var telephony=navigator.mozTelephony;if(telephony){this.listeningCallschanged=false;telephony.removeEventListener('callschanged',this);}},toggleTimeLabel:function sb_toggleTimeLabel(enable){var icon=this.icons.time;if(enable){this.clock.start(this.update.time.bind(this));}else{this.clock.stop();}
icon.hidden=!enable;},updateEmergencyCbNotification:function sb_updateEmergencyCbNotification(show){var icon=this.icons.emergencyCbNotification;if(!show){icon.hidden=true;return;}
icon.hidden=false;},incSystemDownloads:function sb_incSystemDownloads(){this.systemDownloadsCount++;this.update.systemDownloads.call(this);},decSystemDownloads:function sb_decSystemDownloads(){if(--this.systemDownloadsCount<0){this.systemDownloadsCount=0;}
this.update.systemDownloads.call(this);},createConnectionsElements:function sb_createConnectionsElements(){if(this.icons.signals){return;}
this.isRegularMode=SIMSlotManager.hasOnlyOneSIMCardDetected();var conns=window.navigator.mozMobileConnections;if(conns){var multipleSims=SIMSlotManager.isMultiSIM()&&!this.isRegularMode;this.icons.connections.dataset.multiple=multipleSims;this.icons.signals={};this.icons.data={};this.icons.roaming={};this.icons.dataConnection={};this.icons.subscripts={};if(this.supportDualLte){this.icons.imscall={};}
for(var i=conns.length-1;i>=0;i--){var signal=document.createElement('div');var signalBg=document.createElement('div');var data=document.createElement('div');var roaming=document.createElement('div');var dataConnection=document.createElement('div');var iconGroup=document.createElement('div');var subscripts={hidden:true};signal.className='sb-icon sb-icon-signal statusbar-signal';signal.dataset.level='5';signal.dataset.icon='no-sim';signal.setAttribute('role','listitem');signal.hidden=true;if(multipleSims){signal.dataset.index=i+1;signal.dataset.icon='sim-'+signal.dataset.index;}
signalBg.className='sb-icon sb-icon-signal-bg';signalBg.dataset.icon='signal-5';signal.appendChild(signalBg);data.setAttribute('role','listitem');data.className='sb-icon statusbar-data';data.dataset.icon='';data.hidden=true;roaming.setAttribute('role','listitem');roaming.className='sb-icon sb-icon-roaming';roaming.dataset.icon='signal-roaming';roaming.hidden=true;dataConnection.setAttribute('role','listitem');dataConnection.className='sb-icon-network-activity';dataConnection.hidden=true;iconGroup.className='sb-icon-group';signal.appendChild(roaming);iconGroup.appendChild(data);iconGroup.appendChild(dataConnection);iconGroup.appendChild(signal);if(this.supportDualLte){let imscall=document.createElement('div');imscall.setAttribute('role','listitem');imscall.className='sb-icon sb-icon-imscall';imscall.dataset.state='';imscall.dataset.icon='';imscall.hidden=true;this.icons.imscall[i]=imscall;iconGroup.appendChild(imscall);}
this.icons.connections.appendChild(iconGroup);this.icons.signals[i]=signal;this.icons.data[i]=data;this.icons.roaming[i]=roaming;this.icons.dataConnection[i]=dataConnection;this.icons.subscripts[i]=subscripts;}
this.updateConnectionsVisibility();}},createCallForwardingsElements:function sb_createCallForwardingsElements(){if(this.icons.callForwardingsElements){return;}
var conns=window.navigator.mozMobileConnections;if(conns){var multipleSims=SIMSlotManager.isMultiSIM()&&!this.isRegularMode;var sbCallForwardings=document.getElementById('statusbar-call-forwardings');sbCallForwardings.dataset.multiple=multipleSims;this.icons.callForwardingsElements={};for(var idx=conns.length-1;idx>=0;idx--){var callForwarding=document.createElement('div');callForwarding.className='sb-icon sb-icon-call-forwarding';callForwarding.dataset.icon='call-forwarding';if(multipleSims){callForwarding.dataset.index=idx+1;}
callForwarding.setAttribute('role','listitem');callForwarding.setAttribute('aria-label','statusbarForwarding');callForwarding.hidden=true;this.icons.callForwardings.appendChild(callForwarding);this.icons.callForwardingsElements[idx]=callForwarding;}
this.updateCallForwardingsVisibility();}},getAllElements:function sb_getAllElements(){this.icons={};var toCamelCase=function toCamelCase(str){return str.replace(/\-(.)/g,function replacer(str,p1){return p1.toUpperCase();});};this.ELEMENTS.forEach((function createElementRef(name){this.icons[toCamelCase(name)]=document.getElementById('statusbar-'+name);}).bind(this));this.element=document.getElementById('statusbar');this.background=document.getElementById('statusbar-background');this.statusbarIcons=document.getElementById('statusbar-icons');this.statusbarIconsMax=document.getElementById('statusbar-maximized');this.screen=document.getElementById('screen');this.noInternet=document.getElementById('statusbar-wifi-permissions');},updateNotification:function sb_updateNotification(notification_count,listUnread){this.icons.notification.classList.toggle('is-notification-counts--overload',notification_count>99);let counts=document.querySelector('.notification-counts');if(notification_count!==0){this.icons.notification.hidden=false;const last_count=counts.textContent;const last_listUnread=this.icons.notification.classList.contains('listUnread');counts.textContent=notification_count;let unread=listUnread;if(Service.query('isResending')){unread=localStorage.getItem('read')!=='true';}
if(unread&&(last_count<=notification_count||last_listUnread)){this.icons.notification.classList.add('listUnread');}else{this.icons.notification.classList.remove('listUnread');}}else{counts.textContent=0;this.icons.notification.hidden=true;}
this._updateIconVisibility();var detail={count:notification_count};var evt=new CustomEvent('updatenotificationcount',{detail:detail});window.ExternalScreenManager.send(evt);},isLocked:function(){return Service.query('locked');},toCamelCase:function sb_toCamelCase(str){return str.replace(/\-(.)/g,function replacer(str,p1){return p1.toUpperCase();});},log:function sb_log(msg){console.log('[StatusBar] '+msg);},updateVoLTEIndicatorCustomizationValue:function sb_updateVoLTEIndicatorCustomizationValue(){var self=this;self.log('[updateVoLTEIndicatorCustomizationValue]');navigator.customization.getValue('stz.indicator.volte_vowifi.enable').then((result)=>{result=(result===undefined)?0:result;self.log('[updateVoLTEIndicatorCustomizationValue] read value: '+result);self.customizedVoLTEIndicatorShown=result?true:false;self.update.voltecall.call(self);navigator.mozSettings.createLock().set({'indicator.volte_vowifi.enable':result});},(reason)=>{self.log('[updateVoLTEIndicatorCustomizationValue] read value failed, reset to default');self.customizedVoLTEIndicatorShown=false;navigator.mozSettings.createLock().set({'indicator.volte_vowifi.enable':0});});},readVoLTEIndicatorCustomizationValue:function sb_readVoLTEIndicatorCustomizationValue(){var self=this;self.log('[readVoLTEIndicatorCustomizationValue]');var request=navigator.mozSettings.createLock().get('stz.indicator.volte_vowifi.enable');request.onsuccess=function(){var result=request.result['stz.indicator.volte_vowifi.enable'];if(result==null){navigator.mozSettings.addObserver('stz.indicator.volte_vowifi.enable',(event)=>{self.log('[readVoLTEIndicatorCustomizationValue] value changed to: '+result);self.customizedVoLTEIndicatorShown=!!event.settingValue;});}
else{self.log('[readVoLTEIndicatorCustomizationValue] read value: '+result);self.customizedVoLTEIndicatorShown=!!result;}};request.onerror=function(){self.log('[readVoLTEIndicatorCustomizationValue] read value failed, reset to default');self.customizedVoLTEIndicatorShown=false;};}};if(navigator.mozL10n){navigator.mozL10n.once(function(){StatusBar.init();});}