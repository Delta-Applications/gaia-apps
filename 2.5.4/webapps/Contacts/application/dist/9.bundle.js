webpackJsonp([9],{295:function(e,exports,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),c=t(3),u=n(c),s=t(5),l=n(s),d=t(21),f=n(d),m=t(4),p=n(m),h=t(24),v=n(h),g=t(11),y=n(g),_=t(25),b=n(_),E=t(305),k=t(29),w=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name="MergeView",n.DEBUG=!1,n.FOCUS_SELECTOR=".list-item.navigable",n._contactMap={},n.onKeyDown=function(e){switch(e.key){case"Backspace":p.default.request("back",{action:"cancel"});break;case"SoftLeft":"noFound"!==n._status&&p.default.request("back",{action:"cancel"});break;case"Enter":"noFound"===n._status&&p.default.request("back",{action:"cancel"});break;default:return}e.stopPropagation(),e.preventDefault()},n.onItemKeyDown=function(e){var t=document.activeElement.dataset.id,a=t===n.state.selectedId;switch(e.key){case"Enter":n.setState({selectedId:a?"":t});break;case"SoftRight":var o=navigator.mozL10n.get;a&&(0,E.merge)({fromContact:n._contactMap[t],toContact:n._contact,onConflict:function(e,t){var a=[o("merge-conflict-warn",{name:b.default.getDisplayName(n._contact)}),t.map(function(e){return o(e)}).join(", ")," ",o("merge-conflict-confirm")].join("\n");p.default.request("showDialog",{type:"confirm",header:o("confirm"),content:a,translated:!0,ok:"merge",onOk:e})}}).then(function(e){(0,k.operateSync)(k.SYNC_OPERATION.PUSH,{contact:e.data}),p.default.request("ToastManager:show",{text:o("contact-merged")}),p.default.request("back",{action:"merge"})});break;default:return}e.stopPropagation(),e.preventDefault()},n.onItemFocus=function(){n._updateItemSoftKey()},n._listItemFactory=function(e){var t=e.id===n.state.selectedId,a=e.tel&&e.tel.map(function(e){var t=e.type&&e.type.length?e.type[0]:"other",n=Math.random().toString(36).substr(2);return u.default.createElement("div",{className:"secondary",key:"tel-"+n},u.default.createElement("div",null,u.default.createElement("span",{"data-l10n-id":t}),"Â ",e.value))});return u.default.createElement("div",{className:"list-item navigable",tabIndex:"-1",key:e.id,onKeyDown:n.onItemKeyDown,onFocus:n.onItemFocus,"data-id":e.id},u.default.createElement("div",{className:"content"},u.default.createElement("div",{className:"primary"},b.default.getDisplayName(e)),a),u.default.createElement("i",{className:"icon control","data-icon":t?"radio-on":"radio-off"}))},n.state={contacts:null,selectedId:""},n}return r(t,e),i(t,[{key:"componentDidMount",value:function(){var e=this;this.debug("did mount"),this.navigator=new v.default(this.FOCUS_SELECTOR,this.element),this._softKey=f.default.create(this.element,{left:"cancel"}),y.default.getWrappedContact(this.props.id).then(function(t){e._contact=t.contact,(0,E.findDup)(e._contact).then(function(t){e.setState({contacts:t}),t.forEach(function(t){e._contactMap[t.id]=t})})})}},{key:"componentDidUpdate",value:function(){this.debug("did update"),"found"===this._status&&this._updateItemSoftKey(),"noFound"===this._status&&this._softKey.update({left:"",center:"ok"})}},{key:"componentWillUnmount",value:function(){this._softKey.destroy()}},{key:"_updateItemSoftKey",value:function(){var e=document.activeElement.dataset.id,t=e===this.state.selectedId;this._softKey.update({left:"cancel",center:t?"deselect":"select",right:t?"merge":""})}},{key:"render",value:function(){var e=this;this.debug("render");var t="find-dup-title",n={finding:"finding-dup-message",noFound:"no-dup-found",found:"dup-found-message"}[this._status],a=null;"finding"===this._status&&(a=u.default.createElement("div",{className:"progress","data-infinite":"true"},u.default.createElement("div",{className:"progress-active"})));var o=null;return"found"===this._status&&(t="dup-found-title",o=this.state.contacts.map(this._listItemFactory)),u.default.createElement("div",{ref:function(t){e.element=t},className:"merge-view",tabIndex:"-1",onKeyDown:this.onKeyDown},u.default.createElement("div",{className:"header h1","data-l10n-id":t}),u.default.createElement("div",{className:"body"},u.default.createElement("div",{className:"list-item","data-multi-line":"true"},u.default.createElement("div",{className:"content"},u.default.createElement("div",{className:"primary","data-l10n-id":n}),a)),o))}},{key:"_status",get:function(){return this.state.contacts?0===this.state.contacts.length?"noFound":"found":"finding"}}]),t}(l.default);w.defaultProps={id:""},exports.default=w},305:function(e,exports,t){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports._mergeContacts=exports.merge=exports.findDup=void 0;var n=t(11),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=t(22),r=function(e){return e.category&&e.category.includes(o.CLOUD_TAG)?Promise.resolve([]):new Promise(function(t){var n=[],r=e.name&&e.name[0],i=e.tel&&e.tel.map(function(e){return e.value});a.default.getSourceContacts("phone").filter(function(e){return e.category&&!e.category.includes(o.CLOUD_TAG)}).forEach(function(t){if(t.id!==e.id)if(r&&t.name&&t.name[0]===r)n.push(t);else if(i&&t.tel){var a=t.tel.some(function(e){return i.includes(e.value)});a&&n.push(t)}}),t(n)})},i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fromContact,n=e.toContact,o=e.onConflict,r=["name","photo","note","bday","ringtone"].filter(function(e){return!!(n[e]&&n[e].toString()&&t[e]&&t[e].toString())&&("photo"===e?!n[e][0].name||!t[e][0].name||n[e][0].name!==t[e][0].name&&n[e][0].size!==t[e][0].size:n[e].toString()!==t[e].toString())});return new Promise(function(e){r.length&&o?o(e,r):e(!0)}).then(function(){return a.default.remove(t)}).then(function(){var e=c(t,n);return a.default.createOrUpdate(e,!0)})},c=function(e,t){var n=["name","givenName","familyName","photo","note","bday","ringtone"],a={};return(0,o.FIELDS)().forEach(function(o){if(n.includes(o))return void(a[o]=t[o]&&t[o].toString()?t[o]:e[o]);if(a[o]=[],t[o]&&(a[o]=a[o].concat(t[o])),e[o])if("tel"!==o)a[o]=a[o].concat(e[o]);else{var r=t.tel?t.tel.map(function(e){return e.value}):[];e.tel.forEach(function(e){!r.includes(e.value)&&a.tel.push(e)})}}),Object.keys(a).forEach(function(e){t[e]=a[e]&&a[e].toString()?a[e]:null}),t};exports.findDup=r,exports.merge=i,exports._mergeContacts=c}});
//# sourceMappingURL=9.bundle.js.map