webpackJsonp([6],{300:function(e,exports,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),c=t(3),l=n(c),u=t(10),s=n(u),f=t(5),d=n(f),p=t(21),h=n(p),v=t(4),m=n(v),y=t(24),g=n(y),b=t(307),_=n(b),w=t(350),O=n(w),k=t(11),E=n(k),D=t(25),C=n(D);t(138);var I=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name="SpeedDialView",n.DEBUG=!1,n.FOCUS_SELECTOR=".list-item",n.state={contacts:_.default.getAll()},n.onFocus=n.onFocus.bind(n),n}return i(t,e),r(t,[{key:"componentDidMount",value:function(){var e=this;this.debug("did mount");var t=this.getConfig();this.element=s.default.findDOMNode(this),this.onChanged=function(){e.debug("SpeedDialStore onChanged"),e.setState({contacts:_.default.getAll()})},_.default.on("changed",this.onChanged),this.navigator=new g.default(this.FOCUS_SELECTOR,this.element),this._softKey=h.default.create(this.element,t)}},{key:"componentWillUnmount",value:function(){_.default.off("changed",this.onChanged)}},{key:"getConfig",value:function(){var e=document.activeElement.dataset,t={};return"true"===e.voicemail?t.right="edit":e.tel?t.right="options":E.default.isEmpty()||(t.right="add"),_.default.presetDialId===e.id&&(t.right=""),t}},{key:"updateSoftKeys",value:function(){this._softKey.update(this.getConfig())}},{key:"componentDidUpdate",value:function(){this.debug("did update"),this.updateSoftKeys()}},{key:"componentWillUnmount",value:function(){this._softKey.destroy()}},{key:"onKeyDown",value:function(e){var t=navigator.mozL10n.get,n=document.activeElement.dataset;switch(e.key){case"Call":C.default.dial(n.tel);break;case"SoftRight":if(!this._softKey.getSoftKeyValue("right"))break;if(_.default.presetDialId===n.id)break;if("true"===n.voicemail){m.default.request("push","/voicemail");break}if(n.tel)m.default.request("showOptionMenu",{options:[{id:"replace",callback:function(){var e=new MozActivity({name:"pick",data:{type:"webcontacts/tel",params:{typeOfContact:"device"}}});e.onsuccess=function(){if(e.result.id){var a={contact:e.result,telIndex:0};m.default.request("showDialog",{header:t("confirm"),content:t("custom-dialog-replace-speed-dial",{oldSpeedDial:n.name,newSpeedDial:C.default.getDisplayName(a.contact)}),ok:"replace",type:"confirm",translated:!0,onOk:function(){_.default.set(+n.dial,a),m.default.request("ToastManager:show",{text:navigator.mozL10n.get("speed-dial-replaced")})}})}}}},{id:"remove-from-speed-dial",callback:function(){m.default.request("showDialog",{header:t("confirm"),content:t("custom-dialog-remove-speed-dial",{name:n.name}),ok:"remove",type:"confirm",translated:!0,onOk:function(){_.default.remove(+n.dial),m.default.request("ToastManager:show",{text:navigator.mozL10n.get("speed-dial-removed")})}})}}]});else{var a=new MozActivity({name:"pick",data:{type:"webcontacts/tel",params:{typeOfContact:"device"}}});a.onsuccess=function(){if(a.result.id){var e={contact:a.result,telIndex:0};_.default.set(+n.dial,e),m.default.request("ToastManager:show",{text:navigator.mozL10n.get("speed-dial-added")})}}}break;case"Backspace":e.preventDefault(),e.stopPropagation(),C.default.backOrClose()}}},{key:"onFocus",value:function(){this.debug("onFocus:"),this.updateSoftKeys(),m.default.request("ensureDialog")}},{key:"render",value:function(){var e=this,t=[];return this.state.contacts.forEach(function(e,n){t.push(l.default.createElement(O.default,{speeddial:e,key:"speed-dial-"+n}))},this),l.default.createElement("div",{id:"speed-dial-list-view",tabIndex:"-1",onKeyDown:function(t){return e.onKeyDown(t)},onFocus:this.onFocus},l.default.createElement("div",{className:"header h1","data-l10n-id":"speed-dial"}),l.default.createElement("div",{className:"body"},t))}}]),t}(d.default);exports.default=I},302:function(e,exports,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),c=t(38),l=n(c),u=t(8),s=n(u),f=t(4),d=n(f),p=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="Voicemail",e.DEBUG=!1,e.values=[],l.default.addObserver("ril.iccInfo.mbdn",e),e}return i(t,e),r(t,[{key:"getValues",value:function(){return[].concat(this.values)}},{key:"set",value:function(e){l.default.set({"ril.iccInfo.mbdn":Array.isArray(e)?e:[e]}),d.default.request("ToastManager:show",{text:navigator.mozL10n.get("voice-mail-number-updated")})}},{key:"_observe_ril.iccInfo.mbdn",value:function(e){this.debug("detect voicemail changed:",e);var t=navigator.mozMobileConnections.length;this.values=Array.isArray(e)?e:[e],this.values=this.values.map(function(e,n){if(!(n>=t))return e||navigator.mozVoicemail.getNumber(n)}),this.emit("changed")}}]),t}(s.default),h=new p;window.vm=h,exports.default=h},306:function(e,exports,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=t(11),i=function(e){return e&&e.__esModule?e:{default:e}}(o),r=function(){function e(t){var a=t.dial,o=void 0===a?-1:a,i=t.contact,r=void 0===i?null:i,c=t.telIndex,l=void 0===c?0:c;n(this,e),this.dial=o,this.contact=r,this.telIndex=l,this.originTel=""}return a(e,[{key:"updateByRawData",value:function(e){var t=this;return e.contactId?i.default.getContact(e.contactId).then(function(n){if(n&&n.tel){var a=void 0;if(!((a=1===n.tel.length?0:n.tel.map(function(e){return e.value}).indexOf(e.tel))<0))return t.contact=n,t.originTel=e.tel,t.telIndex=a,t}}):(this.contact={id:"",name:[""],tel:[{value:e.tel}]},this.telIndex=0,this)}},{key:"sync",value:function(){var e=this;return navigator.mozContacts.getSpeedDials().then(function(t){var n=t.filter(function(t){return+t.speedDial===e.dial})[0];return n?e.updateByRawData(n):(e.contact=null,e.telIndex=0,Promise.resolve(e))})}},{key:"tel",get:function(){return this.contact&&this.contact.tel&&this.contact.tel[this.telIndex]?this.contact.tel[this.telIndex].value:null}}]),e}();exports.default=r},307:function(e,exports,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),c=t(49),l=n(c),u=t(38),s=n(u),f=t(302),d=n(f),p=t(306),h=n(p),v=t(25),m=n(v),y=function(e){function t(){var e,n,i,r;a(this,t);for(var c=arguments.length,l=Array(c),u=0;u<c;u++)l[u]=arguments[u];return n=i=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),i.SIZE=9,i.contacts=[],i.presetDialId="presetSpeedDial",i._onSpeedDialChange=function(e){i.contacts[+e.speedDial-1].sync().then(function(){i.emit("changed")})},i._onContactChanged=function(e){i.contacts.forEach(function(t){t.contact&&(e.contactID!==t.contact.id&&e.contactID||i.set(t.dial,{contact:{id:"",tel:[{value:t.originTel}]},telIndex:0}))})},r=n,o(i,r)}return i(t,e),r(t,[{key:"start",value:function(){var e=this;window.sds=this,this._initData(),this._fetch(),navigator.mozContacts.addEventListener("contactchange",this._onContactChanged),navigator.mozContacts.addEventListener("speeddialchange",this._onSpeedDialChange),s.default.get("custom.speeddials").then(function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(t){if(t){var n=t.key,a=t.name,o=t.tel;e.contacts[n-1]={dial:n,tel:o,contact:{id:e.presetDialId,name:[a]}},e.emit("changed")}})}),m.default.SUPPORT_VOICEMAIL&&d.default.on("changed",function(){e.contacts[0].tel=d.default.getValues()[0],e.emit("changed")})}},{key:"getAll",value:function(){return this.contacts}},{key:"_initData",value:function(){var e=0;this.contacts=[],m.default.SUPPORT_VOICEMAIL&&(this.contacts[e++]={dial:1,tel:d.default.getValues()[0],voicemail:!0,contact:{id:"voicemail",name:["voicemail"]}});for(var t=e;t<this.SIZE;t++)this.contacts.push(new h.default({dial:t+1}))}},{key:"_fetch",value:function(){var e=this;navigator.mozContacts.getSpeedDials().then(function(t){var n=t.map(function(t){return e.contacts[+t.speedDial-1].updateByRawData(t)});Promise.all(n).then(function(){e.emit("changed")})})}},{key:"set",value:function(e,t){var n=t.contact,a=t.telIndex;void 0===a&&(a=this.contacts[e-1].telIndex),navigator.mozContacts.setSpeedDial(e,n.tel[a].value,n.id).onerror=function(e){}}},{key:"remove",value:function(e){navigator.mozContacts.removeSpeedDial(e).onerror=function(e){}}}]),t}(l.default),g=new y;g.start(),exports.default=g},350:function(e,exports,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),c=t(3),l=n(c),u=t(5),s=n(u),f=t(25),d=n(f),p=function(e){function t(){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),r(t,[{key:"render",value:function(){var e=this.props.speeddial,t="speeddial-item-label-"+Date.now(),n=navigator.mozL10n.get,a=l.default.createElement("a",{"aria-describedby":t,className:"icon speed-dial-icon",role:"presentation"},e.dial),o=n("empty");return e.voicemail?o=n("voice-mail"):e.contact&&(o=e.contact.id?d.default.hasName(e.contact)?e.contact.name[0]:n("no-name"):e.contact.name[0]),l.default.createElement("div",{className:"contact list-item ",tabIndex:"-1","data-id":e.contact&&e.contact.id,"data-dial":e.dial,"data-tel":e.tel,"data-voicemail":e.voicemail,"data-name":o},a,l.default.createElement("div",{className:"content"},l.default.createElement("div",{className:"primary",id:t},l.default.createElement("a",{href:"/contacts/"+(e.contact&&e.contact.id)},o)),e.tel&&!e.voicemail?l.default.createElement("div",{className:"secondary"},e.tel):null),d.default.isSIMContact(e.contact)?l.default.createElement("i",{"data-icon":"sim",className:"icon"}):null)}}]),t}(s.default);exports.default=p}});
//# sourceMappingURL=6.bundle.js.map