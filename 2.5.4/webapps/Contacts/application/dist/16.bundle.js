webpackJsonp([16],{297:function(e,exports,t){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var u=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),i=t(3),c=a(i),s=t(10),d=a(s),l=t(5),f=a(l),p=t(21),m=a(p),y=t(4),h=a(y),b=t(24),v=a(b),g=t(79),k=a(g),E=t(29),w=t(11),I=a(w),S=t(130),O=a(S),_=function(e){function t(e){n(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.name="SettingView",a.DEBUG=!1,a.FOCUS_SELECTOR=".navigable",a.debug("constructor"),a.state={rule:I.default.sortingRule,memory:I.default.source,sdn:!1,accounts:[],isOnLine:navigator.onLine},window.addEventListener("online",a),window.addEventListener("offline",a),a}return r(t,e),u(t,[{key:"_handle_online",value:function(){this.setState({isOnLine:navigator.onLine})}},{key:"_handle_offline",value:function(){this.setState({isOnLine:navigator.onLine},function(){h.default.request("offlineCallback")})}},{key:"componentDidMount",value:function(){var e=this;this.debug("did mount"),this.element=d.default.findDOMNode(this),this.navigator=new v.default(this.FOCUS_SELECTOR,this.element),this.updateSoftKeys(),O.default.getCardWithSDNList().then(function(){O.default.getSDNContacts().some(function(e){return e&&e.length})&&e.setState({sdn:!0})}),E.accountStore.whenReady.then(function(){e.setState({accounts:E.accountStore.getAccounts()}),E.accountStore.on("changed",function(t){e.setState({accounts:E.accountStore.getAccounts()},function(){var a=e.element.querySelector('[data-account-id="'+t+'"]');a&&e.navigator.setFocus(a)})})})}},{key:"componentWillUnmount",value:function(){this.debug("will unmount"),this._softKey.destroy(),window.removeEventListener("online",this),window.removeEventListener("offline",this)}},{key:"updateSoftKeys",value:function(){var e={center:"select"};this._softKey=m.default.create(this.element,e)}},{key:"onKeyDown",value:function(e){var t=this;switch(e.key){case"Enter":if(document.activeElement.classList.contains("disabled"))return;switch(document.activeElement.dataset.actionType){case"import":if(I.default.fullDisk){var a=navigator.mozL10n.get;h.default.request("showDialog",{header:a("phone-storage-full"),type:"confirm",content:a("import-contact-storage-full"),translated:!0,ok:"settings",onOk:function(){var e=new MozActivity({name:"configure",data:{target:"device",section:"mediaStorage"}});e.onerror=function(){}}})}else h.default.request("push","/import");break;case"export":h.default.request("push","/export");break;case"ice":h.default.request("push","/ice");break;case"group":h.default.request("showCreateGroupDialog");break;case"block":h.default.request("push","/block");break;case"speeddial":h.default.request("push","/speeddial");break;case"sort":h.default.request("popup","/sort").then(function(e){e&&e.length&&(I.default.sortingRule=e[0],t.setState({rule:I.default.sortingRule}))});break;case"memory":h.default.request("popup","/memory").then(function(e){e&&e.length&&(I.default.source=e,h.default.request("List:reload"),t.setState({memory:I.default.source}))});break;case"sdn":if(navigator.mozIccManager&&navigator.mozIccManager.iccIds.length>1){var n=[];O.default.getSDNContacts().forEach(function(e,t){e&&n.push({label:"SIM "+(t+1),callback:function(){h.default.request("push","/sdn/"+t)}})}),h.default.request("showOptionMenu",{header:"select-sim",options:n})}else h.default.request("push","/sdn/0");break;case"account":h.default.request("push","/account/adding");break;case"accountInfo":h.default.request("push","/account/info",{authenticatorId:document.activeElement.dataset.authenticatorId,accountId:document.activeElement.dataset.accountId})}break;case"Backspace":e.preventDefault(),e.stopPropagation(),h.default.request("back")}}},{key:"onFocus",value:function(){h.default.request("ensureDialog")}},{key:"render",value:function(){var e=this;this.debug("render");var t=0===I.default.currentContacts.length,a="sim"===this.state.memory,n=a||t,o=I.default.fullDisk,r=this.state.isOnLine;return c.default.createElement("div",{id:"setting-view",tabIndex:"-1",onKeyDown:function(t){return e.onKeyDown(t)}},c.default.createElement("div",{className:"header h1","data-l10n-id":"settings-title"}),c.default.createElement("div",{className:"body"},c.default.createElement(k.default,{primaryId:"memory",secondaryId:this.state.memory,"data-action-type":"memory",disabled:o}),c.default.createElement(k.default,{primaryId:"sort-contacts",secondaryId:"givenName"===this.state.rule?"sort-by-first-name":"sort-by-last-name","data-action-type":"sort",disabled:n||o}),this.state.sdn?c.default.createElement(k.default,{primaryId:"service-number","data-action-type":"sdn"}):null,c.default.createElement(k.default,{itemType:"button",primaryId:"set-speed-dial","data-action-type":"speeddial"}),c.default.createElement(k.default,{itemType:"button",primaryId:"setICEButton","data-action-type":"ice",disabled:t||o}),c.default.createElement(k.default,{itemType:"button",primaryId:"create-group","data-action-type":"group",disabled:a}),c.default.createElement(k.default,{itemType:"button",primaryId:"block-contacts","data-action-type":"block"}),c.default.createElement("div",{className:"separator secondary","data-l10n-id":"phone-memory"}),c.default.createElement(k.default,{itemType:"button",primaryId:"import-contacts","data-action-type":"import",disabled:a}),c.default.createElement(k.default,{itemType:"button",primaryId:"export-contacts","data-action-type":"export",disabled:t}),c.default.createElement("div",{className:"separator secondary","data-l10n-id":"accounts"}),this.state.accounts.map(function(e){var t=e.authenticatorId,a=e.accountId;return c.default.createElement(k.default,{key:a,"data-action-type":"accountInfo","data-account-id":a,"data-authenticator-id":t,disabled:!r},a)}),c.default.createElement(k.default,{itemType:"button",primaryId:"add-account","data-action-type":"account",disabled:!r})))}}]),t}(f.default);exports.default=_}});
//# sourceMappingURL=16.bundle.js.map