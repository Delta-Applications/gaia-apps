webpackJsonp([26],{279:function(t,exports,e){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var s=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),u=e(3),i=a(u),r=e(5),l=a(r),d=e(4),f=a(d),h=e(24),g=a(h),y=e(21),p=a(y),_=e(79),S=a(_),w=e(29),v=navigator.mozL10n.get,E={LOADING:"loading",CAN_SYNC:"canSync",CAN_NOT_SYNC:"canNotSync",VERIFICATION_FAILED:"verificationFailed",DELETING:"deleting"},I=function(t){function e(t){n(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return a.name="AccountInfo",a.DEBUG=!1,a.onKeyDown=function(t){var e=document.activeElement.dataset.actionType;switch(t.key){case"Enter":if("toggleShowing"===e)return void a.setState({shouldShowContacts:!a.state.shouldShowContacts},function(){a.updateSoftKeys()});if("toggleSyncing"===e){var n=function(){a.setState({shouldSyncContacts:!a.state.shouldSyncContacts},function(){a._account.store.shouldSyncContacts=a.state.shouldSyncContacts,a._updatePageStatus(a.state.shouldSyncContacts?E.CAN_SYNC:E.CAN_NOT_SYNC)})};return void(a.state.shouldSyncContacts?f.default.request("showDialog",{header:v("sync-title"),content:v("sync-account-contacts-warning",{switch:v("sync-account-contacts")}),translated:!0,ok:"yes",onOk:function(){n()}}):n())}if("reEnterPassword"===e)return void a._reEnterPassword();break;case"SoftRight":a.state.pageStatus===E.CAN_SYNC&&a._sync();break;case"SoftLeft":if(a._deletingLock)break;f.default.request("showDialog",{header:"delete-account-long",content:"delete-account-warn",ok:"delete",onOk:function(){a._deleteAccount().then(function(){f.default.request("ToastManager:show",{text:v("delete-account-ok")}),f.default.request("back")})}});break;case"Backspace":if(a._deletingLock)break;f.default.request("back");break;default:return}t.preventDefault(),t.stopPropagation()},a.onFocus=function(){a.updateSoftKeys()},a.debug("constructor:"),a._account=w.accountStore.getAccountById(t.accountId),a.state={pageStatus:E.LOADING,shouldShowContacts:a._account.store.shouldShowContacts,shouldSyncContacts:(0,w.isSyncEnabled)(a._account)},a._deletingLock=!1,window.addEventListener("offline",a),a}return c(e,t),s(e,[{key:"_handle_offline",value:function(){f.default.request("back")}},{key:"componentDidMount",value:function(){var t=this;if(this.debug("did mount"),this.navigator=new g.default(".navigable:not(.disabled)",this.element),this._softKey=p.default.create(this.element,{left:"delete-account"}),!navigator.onLine)return void f.default.request("offlineCallback");this._account.isValid(this._account).then(function(){t._updatePageStatus(t.state.shouldSyncContacts?E.CAN_SYNC:E.CAN_NOT_SYNC)}).catch(function(){t.debug("account invalid"),t._updatePageStatus(E.VERIFICATION_FAILED)})}},{key:"componentWillUnmount",value:function(){this.debug("will unmount"),this._softKey.destroy(),window.removeEventListener("offline",this),this._account.store.shouldShowContacts!==this.state.shouldShowContacts&&(this._account.store.shouldShowContacts=this.state.shouldShowContacts,w.accountStore.set(this._account),f.default.request("ToastManager:show",{text:v("changes-saved")}),f.default.request("List:reload"))}},{key:"_sync",value:function(){if(!(0,w.isSyncEnabled)(this._account))return void f.default.request("showDialog",{header:v("sync-title"),type:"alert",content:[v("sync-failed-warn"),v("sync-off-warn")].join("\n"),translated:!0});f.default.request("ToastManager:show",{text:v("contact-syncing")}),(0,w.operateSync)(w.SYNC_OPERATION.PULL,{account:this._account})}},{key:"_deleteAccount",value:function(){var t=this,e=this.state.pageStatus;return this._updatePageStatus(E.DELETING),this._deletingLock=!0,this._account.reset().then(function(){return(0,w.logout)(t._account)}).then(function(){return t._deletingLock=!1,!0}).catch(function(a){throw t._deletingLock=!1,t._updatePageStatus(e),f.default.request("ToastManager:show",{text:v("delete-account-failed")}),a})}},{key:"_reEnterPassword",value:function(){var t=this;f.default.request("popup","/account/change-password",{accountId:this._account.accountId,authenticatorId:this._account.authenticatorId,invalidPassword:this.state.pageStatus===E.VERIFICATION_FAILED}).then(function(e){e[0]&&e[0].invalidPassword?t._updatePageStatus(E.VERIFICATION_FAILED):t._updatePageStatus(E.CAN_SYNC)})}},{key:"_updatePageStatus",value:function(t){var e=this;this._deletingLock||(this.setState({pageStatus:t},function(){e.focus()}),this.updateSoftKeys(t))}},{key:"updateSoftKeys",value:function(t){if(!t||E.DELETING!==t){if(!t&&E.DELETING===this.state.pageStatus)return void this._softKey.update({});var e=document.activeElement.dataset.actionType,a={left:"delete-account"};switch(a.right=this.state.shouldSyncContacts&&E.VERIFICATION_FAILED!==this.state.pageStatus?"sync":"",e){case"toggleShowing":a.center=this.state.shouldShowContacts?"deselect":"select";break;case"toggleSyncing":a.center=this.state.shouldSyncContacts?"deselect":"select";break;case"reEnterPassword":a.center="select";break;default:a.right=""}this._softKey.update(a)}}},{key:"render",value:function(){var t=this,e=this.props,a=e.accountId,n=e.authenticatorId,o=this.state.pageStatus,c=[i.default.createElement(S.default,{key:"show-account-contacts",primaryId:"show-account-contacts","data-action-type":"toggleShowing",rightIcon:this.state.shouldShowContacts?"check-on":"check-off"}),i.default.createElement(S.default,{key:"sync-account-contacts",primaryId:"sync-account-contacts","data-action-type":"toggleSyncing",rightIcon:this.state.shouldSyncContacts?"check-on":"check-off"})];if("activesync"===n&&c.push(i.default.createElement(S.default,{key:"re-enter-password",primaryId:"re-enter-password","data-action-type":"reEnterPassword"})),o===E.LOADING)c.push(i.default.createElement(S.default,{key:"loading",primaryId:"loading",isLoading:!0,navigable:!1}));else if(o===E.VERIFICATION_FAILED)c.push(i.default.createElement(S.default,{key:"accessing-warn",multiLine:!0},i.default.createElement("span",{className:"warn","data-l10n-id":"accessing-warn"})," ",i.default.createElement("span",{className:"warn","data-l10n-id":"activesync"===n?"accessing-warn-password":"accessing-warn-relogin"})));else if(o===E.DELETING){var s=i.default.createElement("div",{className:"progress","data-infinite":"true"},i.default.createElement("div",{className:"progress-active"}));c=i.default.createElement("div",{className:"list-item text",tabIndex:"-1"},i.default.createElement("div",{className:"content"},i.default.createElement("div",{className:"primary","data-l10n-id":"deleting-account"}),s))}return i.default.createElement("div",{ref:function(e){t.element=e},tabIndex:"-1",className:"account-info",onKeyDown:this.onKeyDown,onFocus:this.onFocus},i.default.createElement("div",{className:"header h1"},a),c)}}]),e}(l.default);I.defaultProps={authenticatorId:"",accountId:""},exports.default=I}});
//# sourceMappingURL=26.bundle.js.map